<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœŸç¾äº¤æ˜“è¨ˆç®—ç³»çµ±Pro</title>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --tab-bg: #e9ecef;
            --border-color: #dee2e6;
            --primary-blue: #0056b3;
            --text-main: #212529;
            --red-highlight: #d32f2f;
            --green-highlight: #2e7d32;
        }

        * { box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: var(--text-main); }
        .header { background: #fff; padding: 15px; text-align: center; font-size: 1.25rem; font-weight: bold; border-bottom: 2px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .tabs { display: flex; overflow-x: auto; background: var(--tab-bg); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        .tab { flex: 1; min-width: 100px; padding: 15px 10px; text-align: center; color: #666; cursor: pointer; border-bottom: 4px solid transparent; font-size: 0.9rem; font-weight: bold; }
        .tab.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); background: #fff; }
        .container { padding: 15px; max-width: 800px; margin: auto; }
        .panel { display: none; }
        .panel.active { display: block; }
        .input-card { background: #fff; border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .field { display: flex; flex-direction: column; margin-bottom: 10px; }
        label { font-size: 0.85rem; font-weight: bold; margin-bottom: 6px; color: #495057; }
        .section-title { grid-column: span 2; font-size: 1rem; color: var(--primary-blue); border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; font-size: 1rem; }
        button { width: 100%; padding: 14px; background: var(--primary-blue); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-n { background: #6c757d; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; }
        th, td { border: 1px solid var(--border-color); padding: 10px 5px; text-align: center; }
        th { background: #f8f9fa; }
        .highlight-params { text-align: center; font-weight: bold; padding: 12px; background: #fff; border-radius: 8px; margin: 10px 0; border: 1px dashed var(--primary-blue); }
        .match-box { background: #fff9c4; padding: 12px; border-radius: 8px; border: 1px solid #fbc02d; margin-bottom: 10px; text-align: center; font-weight: bold; line-height: 1.6; }
        .text-red { color: var(--red-highlight); font-weight: bold; }
        .text-green { color: var(--green-highlight); font-weight: bold; }
        .diff-text { font-size: 0.8rem; font-weight: normal; }
        .table-title { font-weight: bold; margin: 20px 0 8px 0; border-left: 4px solid var(--primary-blue); padding-left: 10px; }
    </style>
</head>
<body>

<div class="header">æœŸç¾äº¤æ˜“è¨ˆç®—ç³»çµ±Pro</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab(0)">æœŸç¾CDP</div>
    <div class="tab" onclick="switchTab(1)">å¤šå›æª”ä¸ŠN</div>
    <div class="tab" onclick="switchTab(2)">ç©ºåå½ˆä¸‹N</div>
    <div class="tab" onclick="switchTab(3)">é»ƒé‡‘æ’å£“</div>
</div>

<div class="container">
    <div id="panel0" class="panel active">
        <div class="input-card">
            <div class="grid">
                <div class="section-title">ğŸ“Š æœŸè²¨åƒæ•¸ (Futures)</div>
                <div class="field"><label>é–‹ç›¤ (O)</label><input type="number" id="o_f"></div>
                <div class="field"><label>æœ€é«˜ (H)</label><input type="number" id="h_f"></div>
                <div class="field"><label>æœ€ä½ (L)</label><input type="number" id="l_f"></div>
                <div class="field"><label>æ”¶ç›¤ (C)</label><input type="number" id="c_f"></div>
                
                <div class="section-title">ğŸ“‰ ç¾è²¨åƒæ•¸ (Spot)</div>
                <div class="field"><label>é–‹ç›¤ (O)</label><input type="number" id="o_s"></div>
                <div class="field"><label>æœ€é«˜ (H)</label><input type="number" id="h_s"></div>
                <div class="field"><label>æœ€ä½ (L)</label><input type="number" id="l_s"></div>
                <div class="field"><label>æ”¶ç›¤ (C)</label><input type="number" id="c_s"></div>
            </div>
            <button onclick="calcCombinedCDP()">è¨ˆç®—æœŸç¾CDPå°ç…§</button>
        </div>
        <div id="res0"></div>
    </div>

    <div id="panel1" class="panel">
        <div class="input-card">
            <div class="grid">
                <div class="field"><label>æœ€é«˜ (H)</label><input type="number" id="h2"></div>
                <div class="field"><label>æœ€ä½ (L)</label><input type="number" id="l2"></div>
            </div>
            <button onclick="calcBaseRetrace()">1. è¨ˆç®—åŸºç¤å›æª”</button>
            <div id="c_input2" style="display:none; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                <div class="field"><label>è¼¸å…¥å¯¦éš›å›æª”åƒ¹ä½ (C)</label><input type="number" id="c2"></div>
                <button class="btn-n" onclick="calcNTargetUp()">2. è¨ˆç®—å·®è·æœ€å°åŠNé æ¸¬</button>
            </div>
        </div>
        <div id="res2_base"></div>
        <div id="res2_n"></div>
    </div>

    <div id="panel2" class="panel">
        <div class="input-card">
            <div class="grid">
                <div class="field"><label>æœ€é«˜ (H)</label><input type="number" id="h3"></div>
                <div class="field"><label>æœ€ä½ (L)</label><input type="number" id="l3"></div>
            </div>
            <button onclick="calcBaseRebound()">1. è¨ˆç®—åŸºç¤åå½ˆ</button>
            <div id="c_input3" style="display:none; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                <div class="field"><label>è¼¸å…¥å¯¦éš›åå½ˆåƒ¹ä½ (C)</label><input type="number" id="c3"></div>
                <button class="btn-n" onclick="calcNTargetDown()">2. è¨ˆç®—å·®è·æœ€å°åŠNé æ¸¬</button>
            </div>
        </div>
        <div id="res3_base"></div>
        <div id="res3_n"></div>
    </div>

    <div id="panel3" class="panel">
        <div class="input-card">
            <div class="grid">
                <div class="field"><label>æœ€é«˜ (H)</label><input type="number" id="h4"></div>
                <div class="field"><label>æœ€ä½ (L)</label><input type="number" id="l4"></div>
                <div class="field" style="grid-column: span 2;"><label>æ”¶ç›¤ (C)</label><input type="number" id="c4"></div>
            </div>
            <button onclick="calcGolden()">è¨ˆç®—é»ƒé‡‘æ’å£“</button>
        </div>
        <div id="res4"></div>
    </div>
</div>

<script>
    function switchTab(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
        document.querySelectorAll('.panel').forEach((p, i) => p.classList.toggle('active', i === idx));
    }

    const rnd = (v) => Math.round(v);
    const nRatios = [0.382, 0.5, 0.618, 0.764, 0.809, 1, 1.191, 1.382, 1.5, 1.618, 1.764, 1.809, 2, 2.191, 2.382, 2.5, 2.618, 2.764, 2.809, 3, 3.236, 4.236, 5.236, 6.854];

    function calcCombinedCDP() {
        const of = parseFloat(document.getElementById('o_f').value) || 0;
        const hf = parseFloat(document.getElementById('h_f').value) || 0;
        const lf = parseFloat(document.getElementById('l_f').value) || 0;
        const cf = parseFloat(document.getElementById('c_f').value) || 0;
        const os = parseFloat(document.getElementById('o_s').value) || 0;
        const hs = parseFloat(document.getElementById('h_s').value) || 0;
        const ls = parseFloat(document.getElementById('l_s').value) || 0;
        const cs = parseFloat(document.getElementById('c_s').value) || 0;

        const getCDPObj = (o, h, l, c) => {
            const rg = h - l;
            const cdp = (2 * c + h + l) / 4;
            return { ah: cdp + rg, nh: 2 * cdp - l, cdp: cdp, nl: 2 * cdp - h, al: cdp - rg, m: (h + l) / 2 };
        };

        const f = getCDPObj(of, hf, lf, cf);
        const s = getCDPObj(os, hs, ls, cs);

        let html = `<table><tr><th>æŒ‡æ¨™</th><th>æœŸè²¨</th><th>ç¾è²¨</th></tr>
            <tr><td>AH (æœ€é«˜å£“)</td><td class="text-red">${rnd(f.ah)}</td><td class="text-red">${rnd(s.ah)}</td></tr>
            <tr><td>NH (è¿‘å£“)</td><td>${rnd(f.nh)}</td><td>${rnd(s.nh)}</td></tr>
            <tr style="background:#fff9c4"><td>CDP (ä¸­è»¸)</td><td>${rnd(f.cdp)}</td><td>${rnd(s.cdp)}</td></tr>
            <tr><td>NL (è¿‘æ’)</td><td>${rnd(f.nl)}</td><td>${rnd(s.nl)}</td></tr>
            <tr><td>AL (æœ€ä½æ’)</td><td class="text-green">${rnd(f.al)}</td><td class="text-green">${rnd(s.al)}</td></tr>
            <tr style="border-top: 2px solid #ccc; background:#f1f3f5;"><td><b>1/2 M</b></td><td><b>${rnd(f.m)}</b></td><td><b>${rnd(s.m)}</b></td></tr></table>`;
        document.getElementById('res0').innerHTML = html;
    }

    // --- å¤šå›æª”ä¸ŠN ---
    function calcBaseRetrace() {
        const h = parseFloat(document.getElementById('h2').value) || 0;
        const l = parseFloat(document.getElementById('l2').value) || 0;
        const rg = h - l;
        document.getElementById('res2_n').innerHTML = "";
        let html = `<div class="highlight-params">H-L åƒ¹å·® = ${rnd(rg)}</div><table><tr><th>æ¯”ä¾‹</th><th>å›æª”åƒè€ƒåƒ¹</th></tr>`;
        [0.236, 0.25, 0.382, 0.5, 0.618, 0.75, 0.764].forEach(r => {
            html += `<tr><td>${r}</td><td>${rnd(h - rg*r)}</td></tr>`;
        });
        document.getElementById('res2_base').innerHTML = html + `</table>`;
        document.getElementById('c_input2').style.display = "block";
    }

    function calcNTargetUp() {
        const h = parseFloat(document.getElementById('h2').value) || 0;
        const l = parseFloat(document.getElementById('l2').value) || 0;
        const c = parseFloat(document.getElementById('c2').value) || 0;
        const rg = h - l;
        let minDiff = Infinity, bestR = 0, bestV = 0;
        [0.236, 0.25, 0.382, 0.5, 0.618, 0.75, 0.764].forEach(r => {
            let v = h - rg*r;
            let diff = Math.abs(v - c);
            if(diff < minDiff) { minDiff = diff; bestR = r; bestV = v; }
        });
        
        // æ›´æ­£è™•ï¼šå¯¦éš›å›æª”åƒ¹ä½(C) - å›æª”åƒè€ƒåƒ¹(bestV)
        const priceDiff = rnd(c - bestV);

        let html = `<div class="match-box">
            æœ€æ¥è¿‘æ¯”ä¾‹ï¼š${bestR}<br>
            åƒè€ƒåƒ¹ï¼š${rnd(bestV)}<br>
            å¯¦éš›åƒ¹ - åƒè€ƒåƒ¹ï¼š${priceDiff > 0 ? '+' + priceDiff : priceDiff}
        </div>`;
        
        html += `<div class="table-title">ä¸Šæ¼² N ç›®æ¨™ (åƒ¹å·®)</div><table>`;
        nRatios.forEach(r => {
            const val = c + rg * r;
            html += `<tr><td>${r==1?'N(1:1)':r}</td><td class="text-red">${rnd(val)} <span class="diff-text">(+${rnd(val-c)})</span></td></tr>`;
        });
        document.getElementById('res2_n').innerHTML = html + `</table>`;
    }

    // --- ç©ºåå½ˆä¸‹N ---
    function calcBaseRebound() {
        const h = parseFloat(document.getElementById('h3').value) || 0;
        const l = parseFloat(document.getElementById('l3').value) || 0;
        const rg = h - l;
        document.getElementById('res3_n').innerHTML = ""; 
        let html = `<div class="highlight-params">H-L åƒ¹å·® = ${rnd(rg)}</div><table><tr><th>æ¯”ä¾‹</th><th>åå½ˆåƒè€ƒåƒ¹</th></tr>`;
        [0.236, 0.25, 0.382, 0.5, 0.618, 0.75, 0.764].forEach(r => {
            html += `<tr><td>${r}</td><td>${rnd(l + rg*r)}</td></tr>`;
        });
        document.getElementById('res3_base').innerHTML = html + `</table>`;
        document.getElementById('c_input3').style.display = "block";
    }

    function calcNTargetDown() {
        const h = parseFloat(document.getElementById('h3').value) || 0;
        const l = parseFloat(document.getElementById('l3').value) || 0;
        const c = parseFloat(document.getElementById('c3').value) || 0;
        const rg = h - l;
        let minDiff = Infinity, bestR = 0, bestV = 0;
        [0.236, 0.25, 0.382, 0.5, 0.618, 0.75, 0.764].forEach(r => {
            let v = l + rg*r;
            let diff = Math.abs(v - c);
            if(diff < minDiff) { minDiff = diff; bestR = r; bestV = v; }
        });

        // æ›´æ­£è™•ï¼šå¯¦éš›åå½ˆåƒ¹ä½(C) - åå½ˆåƒè€ƒåƒ¹(bestV)
        const priceDiff = rnd(c - bestV);

        let html = `<div class="match-box">
            æœ€æ¥è¿‘æ¯”ä¾‹ï¼š${bestR}<br>
            åƒè€ƒåƒ¹ï¼š${rnd(bestV)}<br>
            å¯¦éš›åƒ¹ - åƒè€ƒåƒ¹ï¼š${priceDiff > 0 ? '+' + priceDiff : priceDiff}
        </div>`;

        html += `<div class="table-title">ä¸‹è·Œ N ç›®æ¨™ (åƒ¹å·®)</div><table>`;
        nRatios.forEach(r => {
            const val = c - rg * r;
            html += `<tr><td>${r==1?'N(1:1)':r}</td><td class="text-green">${rnd(val)} <span class="diff-text">(${rnd(val-c)})</span></td></tr>`;
        });
        document.getElementById('res3_n').innerHTML = html + `</table>`;
    }

    function calcGolden() {
        const h = parseFloat(document.getElementById('h4').value) || 0;
        const l = parseFloat(document.getElementById('l4').value) || 0;
        const c = parseFloat(document.getElementById('c4').value) || 0;
        const x = h - l, m = (h + l) / 2;
        const ps = [0.13, 0.21, 0.34, 0.55, 0.89, 1.13, 1.21, 1.34, 1.55, 1.89, 2.13, 2.21, 2.34, 2.55, 2.89];
        let html = `<div class="highlight-params">X: ${rnd(x)} | M: ${rnd(m)}</div><div class="grid">`;
        let t1 = `<div><div class="table-title">ä¸Šæ¼²ç›®æ¨™</div><table>`;
        ps.forEach(p => {
            const v = m + p * x;
            t1 += `<tr><td>${p}</td><td class="text-red">${rnd(v)}<br><small>(+${rnd(v-c)})</small></td></tr>`;
        });
        let t2 = `<div><div class="table-title">ä¸‹è·Œç›®æ¨™</div><table>`;
        ps.forEach(p => {
            const v = m - p * x;
            t2 += `<tr><td>${p}</td><td class="text-green">${rnd(v)}<br><small>(${rnd(v-c)})</small></td></tr>`;
        });
        document.getElementById('res4').innerHTML = html + t1 + "</table></div>" + t2 + "</table></div></div>";
    }
</script>
</body>
</html>